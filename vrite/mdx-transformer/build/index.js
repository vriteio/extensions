var d=Symbol("usableEnv"),u=Symbol("value"),i=Symbol("id"),l=Symbol("componentName"),r={data:{},func:{},views:{},currentScope:null},c={},v=()=>`_${Math.random().toString(36).substring(2,9)}`,b=new Proxy({},{get(t,e){let n=()=>{};return Object.defineProperty(n,l,{value:e}),n}});var s=t=>{let e=v(),n=t;return Object.defineProperty(n,i,{value:e}),r.func[e]=n,r.currentScope&&r.currentScope.func.push(e),n};var p=t=>{let e=c[t];e&&(e.func.forEach(n=>{delete r.func[n]}),e.temp.forEach(n=>{let o=r.data.temp;o()&&delete o()[n]}))},m=t=>({getEnvironment:()=>r,getMetadata:()=>({__value:u,__id:i,__componentName:l,__usableEnv:d}),generateRuntimeSpec:()=>({...t,onUninstall:t.onUninstall?.[i],onConfigure:t.onConfigure?.[i],configurationView:t.configurationView?.[i],contentPieceView:t.contentPieceView?.[i],blockActions:t.blockActions?.map(e=>({...e,view:e.view[i]})),elements:t.elements?.map(e=>({...e,view:e.view[i]}))}),generateView:async(e,n,o)=>{let a=r.views[e]?.[u];if(a){r.currentScope={func:[],temp:[],uid:o};let f=await a(n);return c[`view:${o}`]=r.currentScope,r.currentScope=null,f}return{component:"",slot:[]}},runFunction:async(e,n,o)=>{let a=r.func[e];a&&(r.currentScope={func:[],temp:[],uid:o},await a(n),c[`func:${o}`]=r.currentScope,r.currentScope=null,p(`func:${o}`))},removeScope:p});var S=m({onConfigure:s(async t=>{(await t.client.transformers.list()).find(o=>o.label==="MDX"&&o.input==="https://extensions.vrite.io/mdx/input"&&o.output==="https://extensions.vrite.io/mdx/output")||await t.client.transformers.create({input:"https://extensions.vrite.io/mdx/input",output:"https://extensions.vrite.io/mdx/output",maxBatchSize:100,label:"MDX"})}),onUninstall:s(async t=>{let e=await t.client.transformers.list();if(e.length>0){let n=e.find(o=>o.label==="MDX"&&o.input==="https://extensions.vrite.io/mdx/input"&&o.output==="https://extensions.vrite.io/mdx/output");n&&await t.client.transformers.delete({id:n?.id})}})});export{S as default};
