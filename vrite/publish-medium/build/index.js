var M=Symbol("usableEnv"),u=Symbol("value"),r=Symbol("id"),g=Symbol("componentName"),a={data:{},func:{},views:{},currentScope:null},y={},C=()=>`_${Math.random().toString(36).substring(2,9)}`,c=new Proxy({},{get(t,e){let o=()=>{};return Object.defineProperty(o,g,{value:e}),o}});function v(t){if(!a.data.temp){let i=()=>a.data.temp[u];Object.defineProperty(i,r,{value:"temp"}),Object.defineProperty(i,u,{value:{},writable:!0}),a.data.temp=i}let e=C(),o=i=>{let l=a.data.temp;l[u][e]&&(l[u][e][u]=i)},n=()=>a.data.temp[u][e][u];return Object.defineProperty(n,r,{value:`temp.${e}`}),Object.defineProperty(n,u,{value:t,writable:!0}),a.data.temp[u][e]=n,a.currentScope&&a.currentScope.temp.push(e),[n,o]}var b=t=>{let e=C(),o=t;return Object.defineProperty(o,r,{value:e}),a.func[e]=o,a.currentScope&&a.currentScope.func.push(e),o},s=(t,e,...o)=>({component:t[g]||"Fragment",slot:o,props:Object.fromEntries(Object.keys(e||{}).map(n=>{let i=e[n];return i&&i[r]?[n,i[r]]:[n,i]}))}),S=(...t)=>({component:"Fragment",slot:t,props:{}}),P=t=>{let e=C(),o={[r]:e,[u]:t};return a.views[e]=o,o},I=t=>{let e=y[t];e&&(e.func.forEach(o=>{delete a.func[o]}),e.temp.forEach(o=>{let n=a.data.temp;n()&&delete n()[o]}))},F=t=>({getEnvironment:()=>a,getMetadata:()=>({__value:u,__id:r,__componentName:g,__usableEnv:M}),generateRuntimeSpec:()=>({...t,onUninstall:t.onUninstall?.[r],onConfigure:t.onConfigure?.[r],configurationView:t.configurationView?.[r],contentPieceView:t.contentPieceView?.[r],blockActions:t.blockActions?.map(e=>({...e,view:e.view[r]})),elements:t.elements?.map(e=>({...e,view:e.view[r]}))}),generateView:async(e,o,n)=>{let i=a.views[e]?.[u];if(i){a.currentScope={func:[],temp:[],uid:n};let l=await i(o);return y[`view:${n}`]=a.currentScope,a.currentScope=null,l}return{component:"",slot:[]}},runFunction:async(e,o,n)=>{let i=a.func[e];i&&(a.currentScope={func:[],temp:[],uid:n},await i(o),y[`func:${n}`]=a.currentScope,a.currentScope=null,I(`func:${n}`))},removeScope:I});var q=F({onUninstall:b(async({client:t})=>{let e=await t.webhooks.list({extensionOnly:!0});e.length>0&&t.webhooks.delete({id:e[0].id})}),onConfigure:b(async({client:t,config:e,spec:o})=>{let n=await t.webhooks.list({extensionOnly:!0}),i=e?.autoPublish&&e?.contentGroupId&&e?.token;n.length>0?i?await t.webhooks.update({id:n[0].id,url:"https://extensions.vrite.io/medium/webhook",metadata:{contentGroupId:`${e.contentGroupId}`}}):await t.webhooks.delete({id:n[0].id}):i&&await t.webhooks.create({name:o.displayName,event:"contentPieceAdded",metadata:{contentGroupId:`${e.contentGroupId}`},url:"https://extensions.vrite.io/medium/webhook"})}),configurationView:P(({use:t})=>{let[e]=t("config.token"),[o,n]=t("config.autoPublish"),[i,l]=t("config.contentGroupId"),[d]=t("config.requireCanonicalLink"),[m]=t("config.draft");return typeof o()!="boolean"&&n(!0),i()||l(""),s(S,null,s(c.Field,{type:"text",color:"contrast",label:"Integration token",placeholder:"Integration token","bind:value":e},"Your Medium Integration token. You can generate one in the [**Security and apps** section](https://medium.com/me/settings/security) of your account settings page"),s(c.Show,{"bind:when":o},s(c.Field,{type:"text",color:"contrast",label:"Content group ID","bind:value":i},"Provide ID of a content group to auto-publish from, when content pieces are moved to it. You can copy the ID from the dashboard."),s(c.Field,{type:"checkbox",color:"contrast",label:"Require canonical link","bind:value":d},"Don't auto-publish when no canonical link is set")),s(c.Field,{type:"checkbox",color:"contrast",label:"Auto-publish","bind:value":o},"Publish posts automatically"),s(c.Field,{type:"checkbox",color:"contrast",label:"Draft","bind:value":m},"whether the article should have the draft status by default"))}),contentPieceView:P(({config:t,token:e,extensionId:o,notify:n,use:i,flush:l})=>{let d=!t?.token||t.autoPublish&&!t.contentGroupId,m=i("contentPiece"),[h,V]=i("data.mediumId"),[k,O]=i("data.autoPublish"),[x,j]=i("data.draft"),[G,f]=v(!1),[D,_]=v(h()?"Republish":"Publish"),A=b(async()=>{try{f(!0),await l();let w=await fetch("https://extensions.vrite.io/medium",{method:"POST",headers:{Authorization:`Bearer ${e}`,"X-Vrite-Extension-Id":o,"Content-Type":"application/json"},body:JSON.stringify({contentPieceId:m().id})}),p=await w.json();if(!w.ok||!p.mediumId)throw new Error("Couldn't publish to Medium");h()?n({text:"Republished to Medium",type:"success"}):n({text:"Published to Medium",type:"success"}),p.mediumId&&p.mediumId!==h()&&V(p.mediumId),f(!1),_("Republish"),await l()}catch{n({text:"Couldn't publish to Medium",type:"error"}),f(!1),await l()}});return typeof x()!="boolean"&&j(t?.draft||!1),typeof k()!="boolean"&&O(!0),s(c.View,{class:"flex flex-col gap-2"},s(c.Field,{type:"checkbox",color:"contrast",label:"Draft","bind:value":x,disabled:d},"whether the article should have the draft status by default"),s(c.Show,{when:t?.autoPublish},s(c.Field,{type:"checkbox",color:"contrast",label:"Auto-publish","bind:value":k,disabled:d},"whether the article should be auto-published")),s(c.Button,{color:"primary",class:"w-full flex justify-center items-center m-0",disabled:d,"bind:loading":G,"on:click":A},s(c.Text,{"bind:content":D})))})});export{q as default};
