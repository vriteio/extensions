var M=Symbol("usableEnv"),c=Symbol("value"),u=Symbol("id"),g=Symbol("componentName"),i={data:{},func:{},views:{},currentScope:null},y={},C=()=>`_${Math.random().toString(36).substr(2,9)}`,r=new Proxy({},{get(t,e){let o=()=>{};return Object.defineProperty(o,g,{value:e}),o}});function v(t){if(!i.data.temp){let a=()=>i.data.temp[c];Object.defineProperty(a,u,{value:"temp"}),Object.defineProperty(a,c,{value:{},writable:!0}),i.data.temp=a}let e=C(),o=a=>{let l=i.data.temp;l[c][e]&&(l[c][e][c]=a)},n=()=>i.data.temp[c][e][c];return Object.defineProperty(n,u,{value:`temp.${e}`}),Object.defineProperty(n,c,{value:t,writable:!0}),i.data.temp[c][e]=n,i.currentScope&&i.currentScope.temp.push(e),[n,o]}var b=t=>{let e=C(),o=t;return Object.defineProperty(o,u,{value:e}),i.func[e]=o,i.currentScope&&i.currentScope.func.push(e),o},s=(t,e,...o)=>({component:t[g]||"Fragment",slot:o,props:Object.fromEntries(Object.keys(e||{}).map(n=>{let a=e[n];return a[u]?[n,a[u]]:[n,a]}))}),S=(...t)=>({component:"Fragment",slot:t,props:{}}),P=t=>{let e=C(),o={[u]:e,[c]:t};return i.views[e]=o,o},I=t=>{let e=y[t];e&&(e.func.forEach(o=>{delete i.func[o]}),e.temp.forEach(o=>{let n=i.data.temp;n()&&delete n()[o]}))},F=t=>({getEnvironment:()=>i,getMetadata:()=>({__value:c,__id:u,__componentName:g,__usableEnv:M}),generateRuntimeSpec:()=>({...t,onUninstall:t.onUninstall?.[u],onConfigure:t.onConfigure?.[u],configurationView:t.configurationView?.[u],contentPieceView:t.contentPieceView?.[u],blockActions:t.blockActions?.map(e=>({...e,view:e.view[u]}))}),generateView:(e,o)=>{let n=i.views[e]?.[c];if(n){i.currentScope={func:[],temp:[]};let a=n(o);return y[`view:${e}`]=i.currentScope,i.currentScope=null,a}},runFunction:(e,o)=>{let n=i.func[e];n&&(i.currentScope={func:[],temp:[]},n(o),y[`func:${e}`]=i.currentScope,i.currentScope=null,I(`func:${e}`))},removeScope:I});var q=F({onUninstall:b(async({client:t})=>{let e=await t.webhooks.list({extensionOnly:!0});e.length>0&&t.webhooks.delete({id:e[0].id})}),onConfigure:b(async({client:t,config:e,spec:o})=>{let n=await t.webhooks.list({extensionOnly:!0}),a=e?.autoPublish&&e?.contentGroupId&&e?.token;n.length>0?a?await t.webhooks.update({id:n[0].id,url:"https://extensions.vrite.io/medium/webhook",metadata:{contentGroupId:`${e.contentGroupId}`}}):await t.webhooks.delete({id:n[0].id}):a&&await t.webhooks.create({name:o.displayName,event:"contentPieceAdded",metadata:{contentGroupId:`${e.contentGroupId}`},url:"https://extensions.vrite.io/medium/webhook"})}),configurationView:P(({use:t})=>{let[e]=t("config.token"),[o,n]=t("config.autoPublish"),[a,l]=t("config.contentGroupId"),[d]=t("config.requireCanonicalLink"),[m]=t("config.draft");return typeof o()!="boolean"&&n(!0),a()||l(""),s(S,null,s(r.Field,{type:"text",color:"contrast",label:"Integration token",placeholder:"Integration token","bind:value":e},"Your Medium Integration token. You can generate one in the [**Security and apps** section](https://medium.com/me/settings/security) of your account settings page"),s(r.Show,{"bind:when":o},s(r.Field,{type:"text",color:"contrast",label:"Content group ID","bind:value":a},"Provide ID of a content group to auto-publish from, when content pieces are moved to it. You can copy the ID from the dashboard."),s(r.Field,{type:"checkbox",color:"contrast",label:"Require canonical link","bind:value":d},"Don't auto-publish when no canonical link is set")),s(r.Field,{type:"checkbox",color:"contrast",label:"Auto-publish","bind:value":o},"Publish posts automatically"),s(r.Field,{type:"checkbox",color:"contrast",label:"Draft","bind:value":m},"whether the article should have the draft status by default"))}),contentPieceView:P(({config:t,token:e,extensionId:o,notify:n,use:a,flush:l})=>{let d=!t?.token||t.autoPublish&&!t.contentGroupId,m=a("contentPiece"),[h,V]=a("data.mediumId"),[k,O]=a("data.autoPublish"),[x,j]=a("data.draft"),[G,f]=v(!1),[D,_]=v(h()?"Republish":"Publish"),A=b(async()=>{try{f(!0),await l();let w=await fetch("https://extensions.vrite.io/medium",{method:"POST",headers:{Authorization:`Bearer ${e}`,"X-Vrite-Extension-Id":o,"Content-Type":"application/json"},body:JSON.stringify({contentPieceId:m().id})}),p=await w.json();if(!w.ok||!p.mediumId)throw new Error("Couldn't publish to Medium");h()?n({text:"Republished to Medium",type:"success"}):n({text:"Published to Medium",type:"success"}),p.mediumId&&p.mediumId!==h()&&V(p.mediumId),f(!1),_("Republish"),await l()}catch{n({text:"Couldn't publish to Medium",type:"error"}),f(!1),await l()}});return typeof x()!="boolean"&&j(t?.draft||!1),typeof k()!="boolean"&&O(!0),s(r.View,{class:"flex flex-col gap-2"},s(r.Field,{type:"checkbox",color:"contrast",label:"Draft","bind:value":x,disabled:d},"whether the article should have the draft status by default"),s(r.Show,{when:t?.autoPublish},s(r.Field,{type:"checkbox",color:"contrast",label:"Auto-publish","bind:value":k,disabled:d},"whether the article should be auto-published")),s(r.Button,{color:"primary",class:"w-full flex justify-center items-center m-0",disabled:d,"bind:loading":G,"on:click":A},s(r.Text,{"bind:content":D})))})});export{q as default};
